<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manipulating Stics text files • SticsRFiles</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Manipulating Stics text files">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SticsRFiles</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/SticsRFiles.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Generating_Stics_text_files.html">Generating Stics text files from XML files</a>
    </li>
    <li>
      <a href="../articles/Generating_Stics_XML_files.html">Generating Stics XML files from XL files data, `mailing` use case</a>
    </li>
    <li>
      <a href="../articles/Manipulating_Stics_text_files.html">Manipulating Stics text files</a>
    </li>
    <li>
      <a href="../articles/Manipulating_Stics_XML_files.html">Manipulating Stics XML files</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SticsRPacks/SticsRFiles">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Manipulating Stics text files</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/SticsRPacks/SticsRFiles/blob/master/vignettes/Manipulating_Stics_text_files.Rmd"><code>vignettes/Manipulating_Stics_text_files.Rmd</code></a></small>
      <div class="hidden name"><code>Manipulating_Stics_text_files.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(SticsRFiles)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co">#&gt; Learn SticsRFiles at: https://SticsRPacks.github.io/SticsRFiles</span></a></code></pre></div>
<hr>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>This package allows the user to programatically manipulate either the XML files used to store more information, or the text files directly used as inputs by the STICS model. This vignette explains the second one. For more details on how to manipulate XML files, please refer to the vignette <a href="https://sticsrpacks.github.io/SticsRFiles/articles/Manipulating_Stics_XML_files.html">Manipulating Stics XML files</a>.</p>
<blockquote>
<p>Disclaimer: These functionalities are more oriented toward advanced users and/or developers.</p>
</blockquote>
<p>Using this package, it is possible to:</p>
<ul>
<li>convert the XML files to text files (<code><a href="../reference/convert_xml2txt.html">convert_xml2txt()</a></code>), please see the <a href="https://sticsrpacks.github.io/SticsRFiles/articles/Generating_Stics_text_files">Generating Stics text files</a> vignette;<br>
</li>
<li>read (<a href="R/read_param.R"><code><a href="../reference/get_param_txt.html">get_param_txt()</a></code></a>) or set (<a href="R/read_param.R"><code><a href="../reference/set_param_txt.html">set_param_txt()</a></code></a>) parameters;<br>
</li>
<li>Read the climate (<code><a href="../reference/get_climate_txt.html">get_climate_txt()</a></code>);<br>
</li>
<li>Set the output variables required (<code><a href="../reference/set_param_txt.html">set_out_var_txt()</a></code>).</li>
</ul>
<p>To run a STICS simulation on these input files, please refer to the <a href="https://sticsrpacks.github.io/SticsOnR/reference/run_stics.html"><code>run_stics()</code></a> function from <a href="https://sticsrpacks.github.io/SticsOnR/index.html">SticsOnR</a>.</p>
<p>Some example data is available from the package and can be retreived using:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">example_txt_dir &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"extdata"</span>,<span class="st">"txt"</span>,<span class="st">"V9.0"</span>), <span class="dt">package =</span> <span class="st">"SticsRFiles"</span> )</a></code></pre></div>
</div>
<div id="getting-parameter-value" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-parameter-value" class="anchor"></a>Getting parameter value</h2>
<p><code><a href="../reference/get_param_txt.html">get_param_txt()</a></code> helps to get the value of a given parameter in a USM. It has two arguments, the directory of the USM (<code>dirpath</code>, where the text files lives), and the parameter name (<code>param</code>).</p>
<p>For example to get the value of the atmospheric pressure:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw"><a href="../reference/get_param_txt.html">get_param_txt</a></span>(<span class="dt">dirpath =</span> example_txt_dir, <span class="dt">param=</span><span class="st">'patm'</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co">#&gt; station.P_patm </span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co">#&gt;         "1000"</span></a></code></pre></div>
<p>The function returns a vector with all the values found for the parameter (here “1000”) named according to the file where it found the parameter value (here “station”), along with the parameter name as found in the file. The function performs a fuzzy search, so the name of the parameter can be only partially given, e.g.:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw"><a href="../reference/get_param_txt.html">get_param_txt</a></span>(<span class="dt">dirpath =</span> example_txt_dir, <span class="dt">param=</span><span class="st">'atm'</span>)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co">#&gt; station.P_patm </span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">#&gt;         "1000"</span></a></code></pre></div>
<p>Note that the function does not require the user to know in which file the parameter is because it search the parameter in all files. So if it finds several parameter with the same given name, it will return all:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw"><a href="../reference/get_param_txt.html">get_param_txt</a></span>(<span class="dt">dirpath =</span> example_txt_dir, <span class="dt">param=</span><span class="st">'a'</span>)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">#&gt;           general.P_beta         general.P_FTEMha         general.P_FTEMra </span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&gt;                      "2"                   "0.12"                  "0.103" </span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&gt;       plant.plant1.P_sea  plant.plant1.P_minefnra     plant.plant1.P_Nmeta </span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">#&gt;                    "100"                   "-999"                    "4.8" </span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">#&gt; plant.plant1.P_masecmeta             station.P_ra </span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">#&gt;                   "0.04"                     "50"</span></a></code></pre></div>
<p>Here we see another peculiarity: the name associated to the value has more information for the plant file, e.g. " plant.plant1.P_Nmeta" instead of " plant.P_Nmeta". This is because a USM can potentially have two plant files if it is an intercrop, so the function returns the plant file index where the parameter was found.</p>
<p>It is the same case for the tec file:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="../reference/get_param_txt.html">get_param_txt</a></span>(<span class="dt">dirpath =</span> example_txt_dir, <span class="dt">param=</span><span class="st">'interrang'</span>)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co">#&gt; tec.plant1.P_interrang </span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">#&gt;                    "2"</span></a></code></pre></div>
<p>The <code><a href="../reference/get_param_txt.html">get_param_txt()</a></code> function is a wrapper around other lower-level functions that reads the parameter values in a given file:</p>
<ul>
<li>get_ini_txt() for the <code>ficini.txt</code> file;<br>
</li>
<li>get_general_txt() for the <code>tempopar.sti</code> file;<br>
</li>
<li>get_tmp_txt() for the <code>tempoparv6.sti</code> file;<br>
</li>
<li>get_plant_txt() for the <code>ficplt.txt</code> file;<br>
</li>
<li>get_tec_txt() for the <code>fictec.txt</code> file;<br>
</li>
<li>get_soil_txt() for the <code>param.sol</code> file;<br>
</li>
<li>get_station_txt() for the <code>station.txt</code> file;<br>
</li>
<li>get_usm_txt() for the <code>new_travail.usm</code> file;<br>
</li>
<li>get_out_var_txt() for the <code>var.mod</code> file;</li>
</ul>
<p>All these functions are exported for convenience, but <code><a href="../reference/get_param_txt.html">get_param_txt()</a></code> is easier to use.</p>
</div>
<div id="getting-the-meteorological-data" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-the-meteorological-data" class="anchor"></a>Getting the meteorological data</h2>
<p>The <code><a href="../reference/get_climate_txt.html">get_climate_txt()</a></code> function helps to get the data from the <code>climat.txt</code> file, and is used as:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw"><a href="../reference/get_climate_txt.html">get_climate_txt</a></span>(<span class="dt">dirpath =</span> example_txt_dir)</a></code></pre></div>
<pre><code>#&gt;         Date station year month day julian ttmin ttmax ttrg ttetp ttrr ttvent
#&gt; 1 1996-01-01 climais 1996     1   1      1   8.0  11.1  1.2   0.1 17.0 -999.9
#&gt; 2 1996-01-02 climais 1996     1   2      2   7.2   9.4  1.7   0.4  0.5 -999.9
#&gt; 3 1996-01-03 climais 1996     1   3      3   2.2   8.6  2.6   0.2  0.5 -999.9
#&gt; 4 1996-01-04 climais 1996     1   4      4   1.4   8.9  1.6   0.4  2.5 -999.9
#&gt; 5 1996-01-05 climais 1996     1   5      5   5.2   8.8  0.9   0.4  9.2 -999.9
#&gt; 6 1996-01-06 climais 1996     1   6      6   3.8   9.5  1.4   0.0 27.0 -999.9
#&gt;     ttpm ttco2
#&gt; 1 -999.9   330
#&gt; 2 -999.9   330
#&gt; 3 -999.9   330
#&gt; 4 -999.9   330
#&gt; 5 -999.9   330
#&gt; 6 -999.9   330</code></pre>
<p>The function adds a <code>Date</code> column that is at the standard <code>POSIXct</code> format for convenience.</p>
</div>
<div id="set_param_txt" class="section level2">
<h2 class="hasAnchor">
<a href="#set_param_txt" class="anchor"></a><code>set_param_txt()</code>
</h2>
<p><code><a href="../reference/set_param_txt.html">set_param_txt()</a></code> is used to set the value of a given parameter in a USM. It has three main arguments, the directory of the USM (<code>dirpath</code>, where the text files lives), the parameter name (<code>param</code>), and the new value of the parameter.</p>
<p>For example to set the value of the atmospheric pressure read above to 1500:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw"><a href="../reference/set_param_txt.html">set_param_txt</a></span>(<span class="dt">dirpath =</span> example_txt_dir, <span class="dt">param=</span><span class="st">'patm'</span>, <span class="dt">value =</span> <span class="dv">1000</span>)</a></code></pre></div>
<p>Now we can check that the value is changed:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw"><a href="../reference/get_param_txt.html">get_param_txt</a></span>(<span class="dt">dirpath =</span> example_txt_dir, <span class="dt">param=</span><span class="st">'patm'</span>)</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="co">#&gt; station.P_patm </span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co">#&gt;         "1000"</span></a></code></pre></div>
<p>There are two more arguments to the function:</p>
<ul>
<li>
<code>plant</code>: This is used for intercropping when there are two plant and tec files. The user can then choose to which plant the value will be changed.</li>
<li>
<code>add</code>: instead of changing the value of a parameter that already exist in the files, a parameter can be added to the file using this argument. This is used mainly by developpers that added a parameter to the model and need to programatically add it to the input files.</li>
</ul>
<p>Note that as for <code><a href="../reference/get_param_txt.html">get_param_txt()</a></code>, <code><a href="../reference/set_param_txt.html">set_param_txt()</a></code> finds automatically the file where the parameter is. It is also a wrapper around lower-level functions that set the parameter values in a given file:</p>
<ul>
<li>set_ini_txt() for the <code>ficini.txt</code> file;<br>
</li>
<li>set_general_txt() for the <code>tempopar.sti</code> file;<br>
</li>
<li>set_tmp_txt() for the <code>tempoparv6.sti</code> file;<br>
</li>
<li>set_plant_txt() for the <code>ficplt.txt</code> file;<br>
</li>
<li>set_tec_txt() for the <code>fictec.txt</code> file;<br>
</li>
<li>set_soil_txt() for the <code>param.sol</code> file;<br>
</li>
<li>set_station_txt() for the <code>station.txt</code> file;<br>
</li>
<li>set_usm_txt() for the <code>new_travail.usm</code> file;</li>
</ul>
<p>All these functions are exported for convenience, but <code><a href="../reference/set_param_txt.html">set_param_txt()</a></code> is easier to use. These low-level functions may be used when a parameter name is replicated between files and the user wants to change the value of one only, or if the user need to replace the values for a particular variety in the plant file.</p>
</div>
<div id="set-the-output-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#set-the-output-variables" class="anchor"></a>Set the output variables</h2>
<p>The <code><a href="../reference/set_param_txt.html">set_out_var_txt()</a></code> function is used to set the required output variables in the <code>var.mod</code> file. For example if the user need the LAI and the dry mass:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw"><a href="../reference/set_param_txt.html">set_out_var_txt</a></span>(<span class="dt">filepath =</span> <span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(example_txt_dir,<span class="st">"var.mod"</span>), <span class="dt">vars =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lai(n)"</span>,<span class="st">"masec(n)"</span>))</a></code></pre></div>
<p>Controlling if the values where written:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw"><a href="../reference/get_param_txt.html">get_out_var_txt</a></span>(<span class="dt">filepath =</span> <span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(example_txt_dir,<span class="st">"var.mod"</span>))</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="co">#&gt; [1] "lai(n)"   "masec(n)"</span></a></code></pre></div>
<p>Alternatively, the user can append a variable to the pre-existing vector of values using the <code>add</code> argument:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw"><a href="../reference/set_param_txt.html">set_out_var_txt</a></span>(<span class="dt">filepath =</span> <span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(example_txt_dir,<span class="st">"var.mod"</span>), <span class="dt">vars =</span> <span class="st">"hauteur"</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw"><a href="../reference/get_param_txt.html">get_out_var_txt</a></span>(<span class="dt">filepath =</span> <span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(example_txt_dir,<span class="st">"var.mod"</span>))</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="co">#&gt; [1] "lai(n)"   "masec(n)" "hauteur"</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#getting-parameter-value">Getting parameter value</a></li>
      <li><a href="#getting-the-meteorological-data">Getting the meteorological data</a></li>
      <li><a href="#set_param_txt"><code>set_param_txt()</code></a></li>
      <li><a href="#set-the-output-variables">Set the output variables</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Patrice Lecharpentier, Remi Vezy, SticsRPacks.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
